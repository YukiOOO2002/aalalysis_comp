) %>%
tab_options(
table.border.top.color = "lightgray", table.border.bottom.color = "lightgray",
heading.border.bottom.color = "lightgray", table_body.border.bottom.color = "lightgray"
)
# 5. gtオブジェクトの作成
df_des3 <- df_des2 %>%
gt(rowname_col = "Group") %>%
tab_header(
title = md("**グループ別 貢献度平均 (avg_contribute) 記述統計量**"),
subtitle = "グループが**行**、統計量が**列**の形式"
) %>%
tab_style(
style = cell_text(weight = "bold", align = "left"),
locations = cells_stub(rows = everything())
) %>%
tab_stubhead(label = "Group") %>%
cols_label(
N = "N", Mean = "平均", SD = "標準偏差", Median = "中央値", Min = "最小値", Max = "最大値"
) %>%
fmt_number(
columns = c(Mean, SD, Median, Min, Max),
decimals = 2
) %>%
fmt_number(
columns = N,
decimals = 0
) %>%
cols_align(
align = "center",
columns = everything()
) %>%
tab_options(
table.border.top.color = "lightgray", table.border.bottom.color = "lightgray",
heading.border.bottom.color = "lightgray", table_body.border.bottom.color = "lightgray"
)
df_des3_ready <- df_des2 %>%
rownames_to_column(var = "Group")
df_des3 <- df_des3_ready %>%
# rowname_col で 'Group' 列をスタブ列として明示的に指定 ★修正ポイント★
gt(rowname_col = "Group") %>%
# タイトルとサブタイトルを追加
tab_header(
title = md("**グループ別 貢献度平均 (avg_contribute) 記述統計量**"),
subtitle = "グループが**行**、統計量が**列**の形式"
) %>%
# 行名（グループ名）のスタイルを設定（太字）
tab_style(
style = cell_text(weight = "bold", align = "left"),
locations = cells_stub(rows = everything())
) %>%
# 行名（グループ名）のラベルを "Group" と設定
tab_stubhead(label = "Group") %>%
# 列名を日本語に修正
cols_label(
N = "N", Mean = "平均", SD = "標準偏差", Median = "中央値", Min = "最小値", Max = "最大値"
) %>%
# 数値の表示桁数を指定
fmt_number(
columns = c(Mean, SD, Median, Min, Max),
decimals = 2
) %>%
fmt_number(
columns = N,
decimals = 0
) %>%
# 列データの配置を中央揃えに
cols_align(
align = "center",
columns = everything()
) %>%
# 境界線や装飾を追加
tab_options(
table.border.top.color = "lightgray", table.border.bottom.color = "lightgray",
heading.border.bottom.color = "lightgray", table_body.border.bottom.color = "lightgray"
)
# ----------------------------------------------------------------------
# 5. PNGファイルとして保存
# ----------------------------------------------------------------------
save_dir <- "015/analysis/"
all_trend <- paste0(save_dir, "descriptive_analysis_by_group.png")
gtsave(
data = df_des3,
filename = all_trend
)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
rm(list = ls())
library(tidyverse)
library(readr)
setwd("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ")
path <- "015/data/merge_final.csv"
df_base <- read_csv(path, show_col_types = FALSE)
# 3. 保存ディレクトリの設定
save_dir <- "015/analysis/"
# ディレクトリが存在しない場合は作成
if (!dir.exists(save_dir)) {
dir.create(save_dir, recursive = TRUE)
message(paste("Created directory:", save_dir))
}
# 4. グループごとに処理を実行し、散布図を作成・保存
# グループ名 ('base', '015', '03', '045') を取得
group_names <- unique(df_combined$group)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
rm(list = ls())
library(tidyverse)
library(lme4)
library(stargazer)
path <- "015/data/merge_long.csv" # ファイルパスを適切に設定してください
df <- read_csv(path, show_col_types = FALSE)
setwd("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ")
path <- "015/data/merge_long.csv" # ファイルパスを適切に設定してください
df <- read_csv(path, show_col_types = FALSE)
path2 <- "015/data/merge_long_c0.csv"
df2 <- read_csv(path2, show_col_types = FALSE)
model_lmer <- lmer(
formula = contribute ~
`015` + `03` + `045` +
age + gender + affiliation+
(1 | `participant.label`),
data = df,
# REML (限定最尤法) で推定を実行
REML = TRUE
)
# 3. 結果の確認
print("--- 線形混合回帰モデルの結果 ---")
summary(model_lmer)
stargazer(model_lmer, type = "text", title = "Linear Mixed-Effects Model Results")
model_lmer2 <- lmer(
formula = contribute ~
`015` + `03` + `045` + alpha_med +beta_med+
age + gender + affiliation+
(1 | `participant.label`),
data = df,
# REML (限定最尤法) で推定を実行
REML = TRUE
)
# 3. 結果の確認
print("--- 線形混合回帰モデルの結果 ---")
summary(model_lmer2)
stargazer(model_lmer2, type = "text", title = "Linear Mixed-Effects Model Results")
model_lmerc0 <- lmer(
formula = contribute ~
`015` + `03` + `045` +
age + gender + affiliation+
(1 | `participant.label`),
data = df2,
# REML (限定最尤法) で推定を実行
REML = TRUE
)
# 3. 結果の確認
print("--- 線形混合回帰モデルの結果 ---")
summary(model_lmer)
stargazer(model_lmer, type = "text", title = "Linear Mixed-Effects Model Results")
df_long <- df_long %>%
mutate(
contribute_full = if_else(contribute = 10, 1, 0),
# factor型に変換することで、モデルが二値変数として認識しやすくなる
contribute_full = as.factor(contribute_full)
)
df <- df %>%
mutate(
contribute_full = if_else(contribute = 10, 1, 0),
# factor型に変換することで、モデルが二値変数として認識しやすくなる
contribute_full = as.factor(contribute_full)
)
df <- df %>%
mutate(
contribute_full = if_else(contribute == 10, 1, 0),
# factor型に変換することで、モデルが二値変数として認識しやすくなる
contribute_full = as.factor(contribute_full)
)
df <- df %>%
mutate(
contribute_non = if_else(contribute == 0, 1 ,0),
contribute_non = as.factor(contribute_non)
)
View(df)
help(glmer)
model_glmer <- glmer(
formula = contribute_full~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation,
data = df)
model_glmer <- glmer(
formula = contribute_full~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation+
(1 | `participant.label`),
data = df)
model_glmer <- glmer(
formula = contribute_full~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation+
(1 | `participant.label`),
data = df,
family = binomial(link = "probit"))
modelglm <- glm(
formula = contribute_full~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation,
data = df
)
View(df)
count(df$contribute_full)
df <- df %>%
mutate(
contribute_full = if_else(contribute == 10, 1, 0),
)
df <- df %>%
mutate(
contribute_non = if_else(contribute == 0, 1 ,0),
)
count(df$contribute_full)
df <- df %>%
mutate(
contribute_full = if_else(contribute == 10, 1, 0),
# factor型に変換することで、モデルが二値変数として認識しやすくなる
contribute_full = as.numeric(contribute_full)
)
df <- df %>%
mutate(
contribute_non = if_else(contribute == 0, 1 ,0),
contribute_non = as.numeric(contribute_non)
)
count(df$contribute_full)
library(dplyr)
count(df$contribute_full)
count(df)
df %>% count(contribute_full)
df %>% count(c(contribute_full,contribute_non))
df %>% count(contribute_full,contribute_non)
df %>% count(contribute_non)
halp(glm)
help(glm)
modelglm <- glm(
formula = contribute_full~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation,
data = df
)
stargazer(model_glm, type = "text", title = "Linear Mixed-Effects Model Results")
summary(modelglm)
stargazer(modelglm, type = "text", title = "Linear Mixed-Effects Model Results")
modelglm2 <- glm(
formula = contribute_non~
alpha_med + beta_med +
`015` + `03` + `045`+
age + gender + affiliation,
data = df
)
summary(modelglm2)
stargazer(modelglm2, type = "text", title = "Linear Mixed-Effects Model Results")
library(margins)
install.packages("margins")
install.packages("margins")
summary(margins(modelglm))
df$a015 <- df$`015`
df$a03 <- df$`03`
df$a045 <- df$`045`
View(df)
modelglm <- glm(
formula = contribute_full~
alpha_med + beta_med +
a015 + a03 + a045+
age + gender + affiliation,
data = df
)
summary(modelglm)
stargazer(modelglm, type = "text", title = "Linear Mixed-Effects Model Results")
library(margins)
summary(margins(modelglm))
dif_glm <- summary(margins(modelglm))
stargazer(dif_glm, type = "text", title = "Linear Mixed-Effects Model Results")
library(modelsummary)
modelsummary(
dif_glm,
title = "プロビット回帰の平均限界効果 (AME)",
output = "markdown" # または "latex", "html" など
)
modelsummary(
dif_glm,
title = "プロビット回帰の平均限界効果 (AME)",
output = "latex" # または "latex", "html" など
)
dif_glm <- margins(modelglm)
modelsummary(
dif_glm,
title = "プロビット回帰の平均限界効果 (AME)",
output = "latex" # または "latex", "html" など
)
modelsummary(
dif_glm,
title = "プロビット回帰の平均限界効果 (AME)",
output = "markdown" # または "latex", "html" など
)
modelsummary(
dif_glm,
title = "プロビット回帰の平均限界効果 (AME)",
output = "html" # または "latex", "html" など
)
summary(dif_glm)
source("~/.active-rstudio-document", echo = TRUE)
# -----------------------------------
print(prot_data)
# -----------------------------------
print(probit_pdf_prot)
source("~/.active-rstudio-document", echo = TRUE)
cdf_data <- data.frame(
x = x_range,
probability = pnorm(x_range) # 標準正規分布のCDF (Phi(z))
)
# CDFグラフオブジェクトの作成
probit_cdf_plot <- ggplot(cdf_data, aes(x = x, y = probability)) +
# CDF曲線 (シグモイド曲線) を描画
geom_line(color = "blue", linewidth = 1) +
# 平均線形予測子の位置を垂直線で示す
geom_vline(xintercept = mean(eta),
linetype = "dashed", color = "darkgreen", linewidth = 0.8) +
# ゼロ点 (0, 0.5) を示す点を描画
geom_point(aes(x = 0, y = 0.5), color = "red", size = 2) +
# ラベルとタイトル
labs(
title = "プロビット回帰の予測確率 (CDF/シグモイド曲線)",
x = "線形予測子 (eta)",
y = "予測確率 P(y=1 | x) = Φ(eta)"
) +
# Y軸の範囲を0から1に設定
scale_y_continuous(limits = c(0, 1)) +
# テーマ設定
theme_minimal()
# 4. 両方のプロットの描画
print("--- PDFグラフ ---")
print(probit_pdf_plot)
print("--- CDFグラフ ---")
print(probit_cdf_plot)
cdf_data_full <- data.frame(
x = x_range_full,
probability = pnorm(x_range_full) # 標準正規分布のCDF (Phi(z))
)
# 3. CDFグラフオブジェクトの作成
probit_cdf_plot_full <- ggplot(cdf_data_full, aes(x = x, y = probability)) +
# CDF曲線 (シグモイド曲線) を描画
geom_line(color = "blue", linewidth = 1) +
# 平均線形予測子の位置を垂直線で示す (データ範囲は維持)
geom_vline(xintercept = mean(eta),
linetype = "dashed", color = "darkgreen", linewidth = 0.8) +
# ゼロ点 (0, 0.5) を示す点を描画
geom_point(aes(x = 0, y = 0.5), color = "red", size = 2) +
# ラベルとタイトル
labs(
title = "プロビット回帰の予測確率 (CDF/シグモイド曲線) - 全体描画",
x = "線形予測子 (eta)",
y = "予測確率 P(y=1 | x) = Φ(eta)"
) +
# Y軸の範囲を0から1に明示的に設定
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.25)) +
# X軸の範囲を -3 から 3 に設定
scale_x_continuous(limits = c(-3, 3)) +
# テーマ設定
theme_minimal()
x_range_full <- seq(-3, 3, length.out = 500)
cdf_data_full <- data.frame(
x = x_range_full,
probability = pnorm(x_range_full) # 標準正規分布のCDF (Phi(z))
)
# 3. CDFグラフオブジェクトの作成
probit_cdf_plot_full <- ggplot(cdf_data_full, aes(x = x, y = probability)) +
# CDF曲線 (シグモイド曲線) を描画
geom_line(color = "blue", linewidth = 1) +
# 平均線形予測子の位置を垂直線で示す (データ範囲は維持)
geom_vline(xintercept = mean(eta),
linetype = "dashed", color = "darkgreen", linewidth = 0.8) +
# ゼロ点 (0, 0.5) を示す点を描画
geom_point(aes(x = 0, y = 0.5), color = "red", size = 2) +
# ラベルとタイトル
labs(
title = "プロビット回帰の予測確率 (CDF/シグモイド曲線) - 全体描画",
x = "線形予測子 (eta)",
y = "予測確率 P(y=1 | x) = Φ(eta)"
) +
# Y軸の範囲を0から1に明示的に設定
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.25)) +
# X軸の範囲を -3 から 3 に設定
scale_x_continuous(limits = c(-3, 3)) +
# テーマ設定
theme_minimal()
# 4. プロットの描画
print(probit_cdf_plot_full)
source("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ/015/des_stats.R", echo = TRUE)
View(summary_table_avg_contribute)
source("~/.active-rstudio-document", echo = TRUE)
install.packages("rstatix")
install.packages("rstatix")
library(rstatix)
setwd("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ")
path <- "015/data/merge_long.csv"
df <- read_csv(path, show_col_types = FALSE)
# 処置群の定義
groups <- c("base", "015", "03", "045")
wilcox_results <- df %>%
# 必要な変数のみ選択
select(group_type, contribute) %>%
# group_type を因子型に変換（順序は user_defined で）
mutate(group_type = factor(group_type, levels = groups)) %>%
# ペアワイズ検定の実行
wilcox_test(contribute ~ group_type,
paired = FALSE,  # 独立標本 (順位和検定)
p.adjust.method = "bonferroni") %>% # 多重比較補正
# Z値を計算 (W統計量 - 平均) / 標準誤差の近似値
# rstatixは statistic (W-statistic) と p.value を出力するため、
# Z値を近似的に計算する式を加えます (通常、scipy.statsのU検定結果に基づくZ値に近くなります)
mutate(Z_value = qnorm(p.adj/2) * sign(statistic - mean(statistic)) * -1) %>%
# または rstatixが提供するstatisticをZ値として使用
mutate(Z_value = abs(statistic)) %>% # 実際は rstatix の statistic は U-statistic/W-statistic
# より一般的なZ値の近似計算:
# z = qnorm(p_value/2) * sign(median(data1) - median(data2)) * -1
# を用いることも可能ですが、ここでは簡易的に rstatix の出力をベースとします。
# rstatixの statistic は W 統計量です。より正確なZ値は、p-valueから逆算します。
# 符号を決定するため、グループ中央値の差を利用します
group_by(group1, group2) %>%
mutate(
median1 = median(df[df$group_type == group1, ]$contribute, na.rm = TRUE),
median2 = median(df[df$group_type == group2, ]$contribute, na.rm = TRUE),
Z_value = qnorm(p/2, lower.tail = FALSE) * sign(median1 - median2)
) %>%
ungroup() %>%
# 表示用にカラムを調整
select(group1, group2, Z_value, p) %>%
# カラム名をわかりやすく変更
rename(P_value = p)
# Z値の総当たり表を作成
Z_matrix <- wilcox_results %>%
select(group1, group2, Z_value) %>%
spread(key = group2, value = Z_value) %>%
# 行と列を結合し、対角要素をNAまたは0にする
unite(temp, group1, sep = "_") %>%
column_to_rownames(var = "temp") %>%
as.matrix()
# P値の総当たり表を作成
P_matrix <- wilcox_results %>%
select(group1, group2, P_value) %>%
spread(key = group2, value = P_value) %>%
# 行と列を結合し、対角要素をNAまたは0にする
unite(temp, group1, sep = "_") %>%
column_to_rownames(var = "temp") %>%
as.matrix()
# 行名と列名を処置群名に戻す
rownames(Z_matrix) <- groups
colnames(Z_matrix) <- groups
rownames(P_matrix) <- groups
colnames(P_matrix) <- groups
# 上三角行列と下三角行列を結合して総当たり表を完成させる（P値は下三角、Z値は上三角）
# P値の行列をコピー
Combined_matrix <- P_matrix
# 上三角にZ値を挿入
for (i in 1:nrow(Combined_matrix)) {
for (j in 1:ncol(Combined_matrix)) {
if (i < j) { # 上三角要素
# Z値を格納 (group1 vs group2)
Combined_matrix[i, j] <- Z_matrix[i, j]
} else if (i == j) { # 対角要素はNA
Combined_matrix[i, j] <- NA
} else { # 下三角要素 (P値)
# P値を格納 (group2 vs group1 のP値を利用)
Combined_matrix[i, j] <- P_matrix[i, j]
}
}
}
# 整形して出力
print("--- Z値 (上三角) と P値 (下三角) の総当たり表 ---")
print(Combined_matrix)
# 必要に応じて、Z値とP値の行列を別々に出力
print("\n--- Z値の総当たり表 ---")
print(Z_matrix)
print("\n--- P値の総当たり表 ---")
print(P_matrix)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ/015/des_stats.R", echo = TRUE)
source("C:/Users/FMV/OneDrive - OUMail (Osaka University)/デスクトップ/015/des_stats.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
# P値の表を作成・保存
gt_p_table <- create_gt_table(P_matrix, "P値の総当たり表", "P")
library(tidyverse)
library(gt)
library(webshot2)
library(rstatix)
library(tidyr)
# P値の表を作成・保存
gt_p_table <- create_gt_table(P_matrix, "P値の総当たり表", "P")
# P値の表を作成・保存
gt_p <- create_gt_table(P_matrix, "P値の総当たり表", "P")
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
